<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ignisense: Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Tone.js for sound -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #e2e8f0;
            overflow-x: hidden;
        }
        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background-color: #475569; border-radius: 20px; border: 3px solid #1e293b; }
        ::-webkit-scrollbar-thumb:hover { background-color: #fb923c; } 
        .hero-bg {
            background-color: #0a0a0a;
            background-image:
                radial-gradient(at 27% 37%, hsla(215, 98%, 42%, 0.1) 0px, transparent 50%),
                radial-gradient(at 97% 21%, hsla(125, 98%, 42%, 0.1) 0px, transparent 50%),
                radial-gradient(at 82% 99%, hsla(340, 98%, 42%, 0.1) 0px, transparent 50%),
                radial-gradient(at 17% 81%, hsla(283, 98%, 42%, 0.1) 0px, transparent 50%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .glass-card:hover {
            transform: translateY(-5px);
            border-color: rgba(251, 146, 60, 0.5); /* orange-400 with opacity */
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        }
        .glass-card:active { transform: translateY(1px) scale(0.98); transition-duration: 0.1s; }
        .feature-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-radius: 0.75rem;
        }
        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.1);
            background-color: rgba(255,255,255,0.02);
        }
        .feature-card:active { transform: translateY(0px) scale(0.97); transition-duration: 0.1s; }
        .feature-card:hover .feature-icon { transform: scale(1.1); filter: drop-shadow(0 0 10px rgba(99, 102, 241, 0.7)); }
        .nav-link { position: relative; transition: color 0.3s ease; }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #fb923c;
            transition: width 0.3s ease;
        }
        .nav-link:hover::after { width: 100%; }
        [data-observe] { opacity: 0; transform: translateY(30px); transition: opacity 0.8s ease, transform 0.8s ease; }
        [data-observe].visible { opacity: 1; transform: translateY(0); }
        .map-container { height: 500px; border-radius: 1rem; border: 2px solid rgba(255, 255, 255, 0.1); }
        .user-fire-marker {
            color: #f59e0b; /* amber-500 */
            animation: pulse-user 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
        }
        @keyframes pulse-user {
            0%, 100% { transform: scale(1); opacity: 1; filter: drop-shadow(0 0 4px #d97706); }
            50% { transform: scale(1.3); opacity: 0.7; filter: drop-shadow(0 0 12px #d97706); }
        }
        .system-fire-marker {
            color: #ef4444; 
            animation: pulse-system 1s infinite;
        }
        @keyframes pulse-system {
            0%, 100% { transform: scale(1); opacity: 1; filter: drop-shadow(0 0 5px #dc2626); }
            50% { transform: scale(1.4); opacity: 0.8; filter: drop-shadow(0 0 18px #dc2626); }
        }
        .page { transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; }
        .page.hidden { opacity: 0; pointer-events: none; transform: translateX(100%); position: absolute; }
        #report-page.page.hidden { transform: translateX(100%); }
        #main-page.page.hidden { transform: translateX(-100%); }
        #alarm-modal { z-index: 2000; }
        .suggestions-box {
            max-height: 200px;
            overflow-y: auto;
            background-color: #1e293b;
            border: 1px solid #334155;
            border-radius: 0.5rem;
        }
        .suggestion-item { padding: 0.75rem 1rem; cursor: pointer; transition: background-color 0.2s ease; }
        .suggestion-item:hover { background-color: #334155; }
        
        /* Loading Spinner */
        #loading-overlay {
            z-index: 9999;
        }
        .spinner {
            width: 56px;
            height: 56px;
            border: 5px solid #475569;
            border-bottom-color: #fb923c;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center transition-opacity duration-300">
        <div class="spinner"></div>
        <p class="text-white text-lg mt-4">Loading...</p>
    </div>

    <div id="main-page" class="page">
        <header id="header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
            <div class="container mx-auto px-6 py-4">
                <nav class="flex items-center justify-between">
                    <a href="#" class="text-2xl font-bold text-white flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-400"><path d="M12 12.5a3.5 3.5 0 1 1 7 0 3.5 3.5 0 1 1-7 0Z"/><path d="M12 12.5a3.5 3.5 0 1 0-7 0 3.5 3.5 0 1 0 7 0Z"/><path d="M19 12.5c0 .09 0 .18-.01.27"/><path d="M5 12.5c0 .09 0 .18.01.27"/><path d="M12.5 19c.09 0 .18 0 .27-.01"/><path d="M12.5 5c.09 0 .18 0 .27.01"/></svg>
                        <span>Ignisense</span>
                    </a>
                    <div class="hidden md:flex items-center space-x-8">
                        <a href="#hero" class="nav-link text-slate-300 hover:text-orange-400 font-medium">Home</a>
                        <a href="#introduction" class="nav-link text-slate-300 hover:text-orange-400 font-medium">Introduction</a>
                        <a href="#about-us" class="nav-link text-slate-300 hover:text-orange-400 font-medium">About Us</a>
                        <a href="#features" class="nav-link text-slate-300 hover:text-orange-400 font-medium">Features</a>
                        <a href="#map-section" class="nav-link text-slate-300 hover:text-orange-400 font-medium">Live Map</a>
                        <a href="#emergency-contacts" class="nav-link text-slate-300 hover:text-orange-400 font-medium">Hotlines</a>
                        <button id="logout-button-desktop" class="bg-red-600/80 hover:bg-red-700 text-white font-medium py-2 px-5 rounded-full transition-all transform hover:scale-105 duration-300 inline-flex items-center gap-2 text-sm">
                            <i data-lucide="log-out" class="w-4 h-4"></i>
                            <span>Logout</span>
                        </button>
                    </div>
                    <button id="mobile-menu-button" class="md:hidden text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
                    </button>
                </nav>
            </div>
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden bg-black/30 backdrop-blur-md">
                <a href="#hero" class="mobile-nav-link block py-2 px-6 text-slate-300 hover:bg-orange-400/20">Home</a>
                <a href="#introduction" class="mobile-nav-link block py-2 px-6 text-slate-300 hover:bg-orange-400/20">Introduction</a>
                <a href="#about-us" class="mobile-nav-link block py-2 px-6 text-slate-300 hover:bg-orange-400/20">About Us</a>
                <a href="#features" class="mobile-nav-link block py-2 px-6 text-slate-300 hover:bg-orange-400/20">Features</a>
                <a href="#map-section" class="mobile-nav-link block py-2 px-6 text-slate-300 hover:bg-orange-400/20">Live Map</a>
                <a href="#emergency-contacts" class="mobile-nav-link block py-2 px-6 text-slate-300 hover:bg-orange-400/20">Hotlines</a>
                <div class="p-4">
                    <button id="logout-button-mobile" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full transition-all transform hover:scale-105 duration-300 inline-flex items-center justify-center gap-2">
                        <i data-lucide="log-out" class="w-4 h-4"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </header>

        <main>
            <section id="hero" class="relative min-h-screen flex items-center justify-center hero-bg overflow-hidden">
                <canvas id="hero-canvas" class="absolute top-0 left-0 w-full h-full z-0"></canvas>
                <div class="absolute inset-0 bg-black/40"></div>
                <div class="relative z-10 text-center px-6" data-observe>
                    <h1 class="text-4xl md:text-6xl lg:text-7xl font-extrabold text-white leading-tight mb-4">
                        <span class="text-orange-400">Photonic-Based</span> Early Fire Detection
                    </h1>
                    <p class="text-lg md:text-xl text-slate-300 max-w-3xl mx-auto mb-8">
                        A revolutionary multi-spectral alarm system designed to improve safety for homes, schools, and businesses.
                    </p>
                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <a href="#map-section" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-full transition-transform transform hover:scale-105 duration-300">
                            View Live Map
                        </a>
                        <button id="go-to-report-page-btn-hero" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-full transition-transform transform hover:scale-105 duration-300">
                            Report a Fire
                        </button>
                    </div>
                </div>
                 <div class="absolute bottom-10 left-1/2 -translate-x-1/2 text-white animate-bounce"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-down"><path d="M12 5v14"/><path d="m19 12-7 7-7-7"/></svg></div>
            </section>
            
            <section id="introduction" class="py-20 md:py-32 bg-[#101010]">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-16" data-observe>
                        <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">A New Era of Fire Safety</h2>
                        <p class="text-slate-400 max-w-3xl mx-auto">The Ignisense project introduces a photonic-based early fire detection system that redefines response time and accuracy. By analyzing the unique light spectrum of a fire at the moment of ignition, our technology provides an unprecedented advantage in protecting lives and property. Unlike traditional alarms that wait for smoke to accumulate, our system offers instantaneous alerts, drastically reducing the window for a fire to grow and cause irreparable damage.</p>
                    </div>
                </div>
            </section>
            
            <section id="about-us" class="py-20 md:py-32">
                 <div class="container mx-auto px-6">
                     <div class="text-center mb-16" data-observe>
                         <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Our Mission</h2>
                         <p class="text-slate-400 max-w-3xl mx-auto">We are a team of dedicated researchers and engineers committed to leveraging advanced photonic technology to enhance public safety in Tanauan City. Our goal is to create an affordable, reliable, and highly effective fire alarm system that can be deployed in homes, schools, and small businesses. We believe that by providing faster, more accurate detection and seamless integration with local emergency services, we can build a safer, more resilient community for everyone.</p>
                     </div>
                 </div>
            </section>
            
            <section id="features" class="py-20 md:py-32 bg-[#101010]">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-16" data-observe><h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Core Technology Features</h2><p class="text-slate-400 max-w-2xl mx-auto">Our system leverages cutting-edge components for unparalleled accuracy and reliability.</p></div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                        <div class="text-center p-6 feature-card" data-observe><div class="feature-icon inline-block bg-slate-800 p-6 rounded-full mb-4 transition-transform duration-300"><i data-lucide="scan-eye" class="w-10 h-10 text-indigo-400"></i></div><h3 class="text-xl font-semibold text-white mb-2">Multi-Spectral Sensors</h3><p class="text-slate-400">Detects unique light signatures of flames, ignoring false triggers like dust or steam.</p></div>
                        <div class="text-center p-6 feature-card" data-observe style="transition-delay: 150ms;"><div class="feature-icon inline-block bg-slate-800 p-6 rounded-full mb-4 transition-transform duration-300"><i data-lucide="cpu" class="w-10 h-10 text-indigo-400"></i></div><h3 class="text-xl font-semibold text-white mb-2">Smart Microcontroller</h3><p class="text-slate-400">An onboard brain that analyzes data in milliseconds to make critical decisions.</p></div>
                        <div class="text-center p-6 feature-card" data-observe style="transition-delay: 300ms;"><div class="feature-icon inline-block bg-slate-800 p-6 rounded-full mb-4 transition-transform duration-300"><i data-lucide="send" class="w-10 h-10 text-indigo-400"></i></div><h3 class="text-xl font-semibold text-white mb-2">Instantaneous Alerts</h3><p class="text-slate-400">Automatically notifies authorities and property owners the moment a fire is confirmed.</p></div>
                        <div class="text-center p-6 feature-card" data-observe style="transition-delay: 450ms;"><div class="feature-icon inline-block bg-slate-800 p-6 rounded-full mb-4 transition-transform duration-300"><i data-lucide="globe" class="w-10 h-10 text-indigo-400"></i></div><h3 class="text-xl font-semibold text-white mb-2">GPS Pinpointing</h3><p class="text-slate-400">Provides exact coordinates to first responders, saving crucial time.</p></div>
                    </div>
                </div>
            </section>

             <section id="map-section" class="py-20 md:py-32">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-12" data-observe>
                        <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Live Fire Alert Map</h2>
                        <p class="text-slate-400 max-w-2xl mx-auto">Interactive map showing real-time fire reports and automatic system detections in Tanauan City. (Note: Reports are local to this session)</p>
                    </div>
                    <div id="main-map" class="map-container mb-8" data-observe></div>
                    <div class="flex flex-col sm:flex-row justify-center items-center gap-6 mb-8" data-observe>
                        <div class="flex items-center gap-2 text-slate-300"><i data-lucide="flame" class="w-6 h-6 text-red-500"></i> System Detected Fire</div>
                        <div class="flex items-center gap-2 text-slate-300"><i data-lucide="triangle-alert" class="w-6 h-6 text-amber-500"></i> User Reported Fire</div>
                    </div>
                    <div class="text-center" data-observe>
                        <button id="go-to-report-page-btn-map" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-full transition-all transform hover:scale-105 duration-300 inline-flex items-center gap-2">
                            <i data-lucide="siren" class="w-5 h-5"></i>
                            <span>Report a Fire Incident</span>
                        </button>
                    </div>
                </div>
            </section>

            <section id="emergency-contacts" class="py-20 md:py-32 bg-[#101010]">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-16" data-observe>
                        <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Emergency Hotlines</h2>
                        <p class="text-slate-400 max-w-2xl mx-auto">In case of emergency, please contact the relevant authorities in Tanauan City immediately.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                        <div class="glass-card rounded-lg p-6 text-center" data-observe>
                            <div class="inline-block bg-red-500/10 p-4 rounded-full mb-4">
                                <i data-lucide="flame" class="w-8 h-8 text-red-500"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-white mb-2">BFP Tanauan City</h3>
                            <p class="text-slate-400 mb-4">For fire-related emergencies.</p>
                            <a href="tel:043-778-2111" class="text-orange-400 font-bold text-lg hover:underline">(043) 778-2111</a>
                        </div>
                        <div class="glass-card rounded-lg p-6 text-center" data-observe style="transition-delay: 150ms;">
                            <div class="inline-block bg-blue-500/10 p-4 rounded-full mb-4">
                                <i data-lucide="shield" class="w-8 h-8 text-blue-500"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-white mb-2">PNP Tanauan City</h3>
                            <p class="text-slate-400 mb-4">For police assistance.</p>
                            <a href="tel:043-778-1166" class="text-orange-400 font-bold text-lg hover:underline">(043) 778-1166</a>
                        </div>
                        <div class="glass-card rounded-lg p-6 text-center" data-observe style="transition-delay: 300ms;">
                             <div class="inline-block bg-green-500/10 p-4 rounded-full mb-4">
                                 <i data-lucide="activity" class="w-8 h-8 text-green-500"></i>
                             </div>
                            <h3 class="text-xl font-semibold text-white mb-2">CDRRMO Tanauan</h3>
                            <p class="text-slate-400 mb-4">For disaster and medical response.</p>
                            <a href="tel:043-706-7222" class="text-orange-400 font-bold text-lg hover:underline">(043) 706-7222</a>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="bg-slate-900 text-slate-400">
            <div class="container mx-auto px-6 py-12">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <div class="col-span-1 md:col-span-2 lg:col-span-1">
                        <a href="#" class="text-2xl font-bold text-white flex items-center gap-2 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-400"><path d="M12 12.5a3.5 3.5 0 1 1 7 0 3.5 3.5 0 1 1-7 0Z"/><path d="M12 12.5a3.5 3.5 0 1 0-7 0 3.5 3.5 0 1 0 7 0Z"/><path d="M19 12.5c0 .09 0 .18-.01.27"/><path d="M5 12.5c0 .09 0 .18.01.27"/><path d="M12.5 19c.09 0 .18 0 .27-.01"/><path d="M12.5 5c.09 0 .18 0 .27.01"/></svg>
                            <span>Ignisense</span>
                        </a>
                        <p class="text-sm">Revolutionizing fire safety in Tanauan City with advanced photonic detection technology.</p>
                    </div>
                    <div>
                        <h4 class="font-semibold text-white mb-4">Quick Links</h4>
                        <ul class="space-y-2">
                            <li><a href="#hero" class="hover:text-orange-400 transition-colors">Home</a></li>
                            <li><a href="#introduction" class="hover:text-orange-400 transition-colors">Introduction</a></li>
                            <li><a href="#features" class="hover:text-orange-400 transition-colors">Features</a></li>
                            <li><a href="#map-section" class="hover:text-orange-400 transition-colors">Live Map</a></li>
                            <li><a href="#emergency-contacts" class="hover:text-orange-400 transition-colors">Hotlines</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-white mb-4">Contact Us</h4>
                        <ul class="space-y-2">
                            <li><a href="mailto:contact@ignisense.ph" class="hover:text-orange-400 transition-colors flex items-center gap-2"><i data-lucide="mail" class="w-4 h-4"></i> contact@ignisense.ph</a></li>
                            <li><a href="#" class="hover:text-orange-400 transition-colors flex items-center gap-2"><i data-lucide="map-pin" class="w-4 h-4"></i> Tanauan City, Batangas</a></li>
                        </ul>
                    </div>
                    <div>
                         <h4 class="font-semibold text-white mb-4">Follow Us</h4>
                         <div class="flex gap-4">
                             <a href="#" class="bg-slate-800 hover:bg-orange-500 p-2 rounded-full transition-colors"><i data-lucide="twitter" class="w-5 h-5"></i></a>
                             <a href="#" class="bg-slate-800 hover:bg-orange-500 p-2 rounded-full transition-colors"><i data-lucide="facebook" class="w-5 h-5"></i></a>
                             <a href="#" class="bg-slate-800 hover:bg-orange-500 p-2 rounded-full transition-colors"><i data-lucide="linkedin" class="w-5 h-5"></i></a>
                         </div>
                    </div>
                </div>
                <div class="mt-12 border-t border-slate-800 pt-8 text-center text-sm">
                    <p>&copy; 2025 Ignisense Project.  All Rights Reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <div id="report-page" class="page hidden min-h-screen bg-[#101010]">
        <div class="container mx-auto px-6 py-12 md:py-20">
            <button id="back-to-main-btn" class="flex items-center gap-2 text-slate-300 hover:text-orange-400 mb-8 font-semibold">
                <i data-lucide="arrow-left"></i> Back to Home
            </button>
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Report a Fire Incident</h2>
                <p class="text-slate-400 max-w-2xl mx-auto">Type to find a location or click directly on the map to place a pin. Your report will help keep the community safe.</p>
            </div>

            <div class="max-w-4xl mx-auto">
                 <div class="relative">
                     <div class="flex flex-col sm:flex-row gap-2 mb-1">
                         <input type="text" id="location-search-input" placeholder="Search for a location in Tanauan City..." class="flex-grow bg-slate-800 text-white px-4 py-3 rounded-lg border border-slate-700 focus:outline-none focus:ring-2 focus:ring-orange-500">
                         <button id="report-location-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 flex items-center justify-center gap-2">
                             <i data-lucide="siren"></i> <span id="report-btn-text">Report</span>
                         </button>
                     </div>
                     <div id="suggestions-box" class="suggestions-box absolute w-full sm:w-auto left-0 sm:left-auto right-0 sm:right-36 z-[1001] mt-1 hidden"></div>
                 </div>
                <div id="report-map" class="map-container my-8"></div>
                <p id="reporting-instructions" class="text-amber-400 mt-4 text-center">Click on the map to pinpoint the exact fire location and confirm your report.</p>
            </div>
        </div>
    </div>

    <div id="alarm-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="glass-card rounded-2xl p-8 max-w-sm w-full text-center">
            <div id="confirmation-view">
                 <h2 class="text-2xl font-bold text-white mb-4">Confirm Fire Report</h2>
                 <p class="text-slate-300 mb-6">Are you sure you want to report a fire at this location? False reports can have serious consequences.</p>
                <div class="flex justify-center gap-4">
                    <button id="cancel-report-btn" class="bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 px-6 rounded-full transition duration-300">Cancel</button>
                    <button id="confirm-report-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full transition duration-300 flex items-center justify-center">Confirm</button>
                </div>
            </div>
            <div id="alarm-view" class="hidden">
                 <h2 class="text-2xl font-bold text-orange-400 mb-4">REPORT RECEIVED</h2>
                 <p class="text-slate-300 mb-6">Thank you for reporting. This incident will now appear on the live map for your session.</p>
                <button id="silence-alarm-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full transition-transform transform hover:scale-105 duration-300">
                    Close
                </button>
            </div>
            <div id="error-view" class="hidden">
                <div class="mx-auto mb-4 bg-red-500/10 p-3 rounded-full w-fit">
                    <i data-lucide="alert-triangle" class="w-10 h-10 text-red-500"></i>
                </div>
                <h2 class="text-2xl font-bold text-red-400 mb-4">Report Failed</h2>
                <p class="text-slate-300 mb-6" id="error-message-text">Could not submit the fire report. Please try again.</p>
                <button id="close-error-btn" class="bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 px-6 rounded-full transition duration-300">Close</button>
            </div>
        </div>
    </div>

    <script type="module">
        // --- NO Firebase SDK Imports ---

        // --- App State (local) ---
        // Load reports from localStorage on startup
        let userId = null;
        let localReports = JSON.parse(localStorage.getItem('ignisense_reports') || '[]');

        // --- UI Elements ---
        const loadingOverlay = document.getElementById('loading-overlay');
        const mainPage = document.getElementById('main-page');
        const reportPage = document.getElementById('report-page');
        const goToReportButtons = [document.getElementById('go-to-report-page-btn-hero'), document.getElementById('go-to-report-page-btn-map')];
        const backToMainBtn = document.getElementById('back-to-main-btn');
        const alarmModal = document.getElementById('alarm-modal');
        const confirmationView = document.getElementById('confirmation-view');
        const alarmView = document.getElementById('alarm-view');
        const errorView = document.getElementById('error-view');
        const errorMessageText = document.getElementById('error-message-text');
        const cancelReportBtn = document.getElementById('cancel-report-btn');
        const confirmReportBtn = document.getElementById('confirm-report-btn');
        const silenceAlarmBtn = document.getElementById('silence-alarm-btn');
        const closeErrorBtn = document.getElementById('close-error-btn');
        const mainMapContainer = document.getElementById('main-map');
        const reportMapContainer = document.getElementById('report-map');
        const locationSearchInput = document.getElementById('location-search-input');
        const reportLocationBtn = document.getElementById('report-location-btn');
        const reportBtnText = document.getElementById('report-btn-text');
        const suggestionsBox = document.getElementById('suggestions-box');
        const logoutBtnDesktop = document.getElementById('logout-button-desktop');
        const logoutBtnMobile = document.getElementById('logout-button-mobile');

        // --- State Management ---
        const fireMarkers = {}; // Use an object to store markers by report ID
        let mainMap, reportMap;
        let tempReportLocation = null;
        let reportMapMarker = null;
        let debounceTimer;
        let selectedSuggestionLocation = null;
        
        // --- Auth Guard ---
        function initializeAuthListener() {
            // --- Insecure User Override Check ---
            // Check for the flag set by the login page
            if (localStorage.getItem("ignisense_user_override") === "true") {
                console.warn("INSECURE USER OVERRIDE ACTIVE.");
                userId = "hardcoded_user";
                // Manually remove admin flag too, just in case
                localStorage.removeItem("ignisense_admin_override");
                initializeAppLogic(); // Initialize the app
                return; // Bypass all other checks
            }
            
            // Clear any hardcoded admin flags on page load (if user somehow got here)
            localStorage.removeItem("ignisense_admin_override");
            
            // If no override flag, redirect to login.
            console.log("User is not authenticated. Redirecting to login.");
            loadingOverlay.innerHTML = `<p class="text-yellow-400 text-lg">Access Denied. Redirecting to login...</p>`;
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1000);
        }

        // --- Main App Logic (runs after auth) ---
        function initializeAppLogic() {
            lucide.createIcons();
            
            // --- Logout Listeners ---
            const handleLogout = async () => {
                // Clear any override flags
                localStorage.removeItem("ignisense_user_override");
                localStorage.removeItem("ignisense_admin_override");
                // Redirect to login
                window.location.href = 'index.html'; 
            };
            logoutBtnDesktop.addEventListener('click', handleLogout);
            logoutBtnMobile.addEventListener('click', handleLogout);
            
            // --- Hero Canvas Background Effect ---
            const heroCanvas = document.getElementById('hero-canvas');
            if (heroCanvas) {
                const ctx = heroCanvas.getContext('2d');
                let particles = [];
                
                const setCanvasSize = () => {
                    heroCanvas.width = heroCanvas.offsetWidth;
                    heroCanvas.height = heroCanvas.offsetHeight;
                };

                const createParticles = () => {
                    particles = [];
                    const particleCount = Math.floor((heroCanvas.width * heroCanvas.height) / 10000); 
                    for (let i = 0; i < particleCount; i++) {
                        particles.push({
                            x: Math.random() * heroCanvas.width,
                            y: Math.random() * heroCanvas.height,
                            vx: (Math.random() - 0.5) * 0.5,
                            vy: (Math.random() - 0.5) * 0.5,
                            radius: Math.random() * 1.5 + 0.5,
                            opacity: Math.random() * 0.5 + 0.2
                        });
                    }
                };

                const animateParticles = () => {
                    ctx.clearRect(0, 0, heroCanvas.width, heroCanvas.height);
                    particles.forEach(p => {
                        p.x += p.vx;
                        p.y += p.vy;

                        if (p.x < 0 || p.x > heroCanvas.width) p.vx *= -1;
                        if (p.y < 0 || p.y > heroCanvas.height) p.vy *= -1;

                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(251, 146, 60, ${p.opacity})`; // orange-400
                        ctx.fill();
                    });
                    requestAnimationFrame(animateParticles);
                };
                
                const initHeroCanvas = () => {
                    setCanvasSize();
                    createParticles();
                    animateParticles();
                };

                initHeroCanvas();
                window.addEventListener('resize', () => {
                    setCanvasSize();
                    createParticles();
                });
            }
            
            // --- Page Navigation ---
            function showReportPage() { mainPage.classList.add('hidden'); reportPage.classList.remove('hidden'); window.scrollTo(0, 0); if (!reportMap) initReportMap(); }
            function showMainPage() { reportPage.classList.add('hidden'); mainPage.classList.remove('hidden'); window.scrollTo(0, 0); }
            goToReportButtons.forEach(btn => btn.addEventListener('click', showReportPage));
            backToMainBtn.addEventListener('click', showMainPage);

            // --- Mobile Menu ---
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
            mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
            mobileNavLinks.forEach(link => link.addEventListener('click', () => mobileMenu.classList.add('hidden')));

            // --- Header Scroll Effect ---
            const header = document.getElementById('header');
            window.addEventListener('scroll', () => {
                header.classList.toggle('bg-black/50', window.scrollY > 50);
                header.classList.toggle('backdrop-blur-md', window.scrollY > 50);
                header.classList.toggle('shadow-lg', window.scrollY > 50);
            });

            // --- Intersection Observer for Animations ---
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
            }, { threshold: 0.1 });
            document.querySelectorAll('[data-observe]').forEach(el => observer.observe(el));

            // --- Map Icons and Sound ---
            const userFireIcon = L.divIcon({ html: `<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="user-fire-marker"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>`, className: '', iconSize: [40, 40], iconAnchor: [20, 40] });
            const systemFireIcon = L.divIcon({ html: `<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="system-fire-marker"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>`, className: '', iconSize: [40, 40], iconAnchor: [20, 40] });

            const alarmSynth = new Tone.MonoSynth({ oscillator: { type: "square" }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.2, release: 0.2 } }).toDestination();
            let alarmLoop;
            function playAlarm() {
                if (Tone.context.state !== 'running') Tone.start();
                alarmLoop = new Tone.Loop(time => { alarmSynth.triggerAttackRelease("A5", "16n", time); alarmSynth.triggerAttackRelease("E6", "16n", time + 0.2); }, "0.4s").start(0);
                Tone.Transport.start();
            }
            function stopAlarm() { if (alarmLoop) { Tone.Transport.stop(); Tone.Transport.cancel(); alarmLoop.dispose(); } }

            // --- Geocoding and Map Setup ---
            async function getLocationName(lat, lng) {
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`);
                    const data = await response.json();
                    if (data && data.address) {
                        const { village, city, town, municipality, state, country } = data.address;
                        const barangay = village || data.address.suburb || '';
                        const cityName = city || town || municipality || state || '';
                        return [barangay, cityName].filter(Boolean).join(', ') || country || "Unknown Location";
                    } return "Could not determine location name.";
                } catch (error) { console.error("Reverse geocoding error:", error); return `Lat: ${lat.toFixed(4)}, Lng: ${lng.toFixed(4)}`; }
            }
            
            const tanauanCenter = [14.0855, 121.1475];
            const tanauanBounds = L.latLngBounds(L.latLng(14.04, 121.08), L.latLng(14.14, 121.20));
            const nominatimViewbox = '121.08,14.04,121.20,14.14'; 
            const tanauanInstituteCoords = [14.0885, 121.1495];


            const tileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
            const tileAttribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';
            
            async function addMarkerWithPopup(map, latlng, icon, title, markerId) {
                // Clear existing marker first if it exists
                if(fireMarkers[markerId]) {
                   map.removeLayer(fireMarkers[markerId]);
                }
                
                const marker = L.marker(latlng, { icon: icon }).addTo(map);
                const locationName = await getLocationName(latlng[0], latlng[1]);
                marker.bindPopup(`<b>${title}</b><br>${locationName}`);
                fireMarkers[markerId] = marker; // Store marker by its ID
            }
            
            function removeMarker(markerId) {
                if(fireMarkers[markerId]) {
                    mainMap.removeLayer(fireMarkers[markerId]);
                    delete fireMarkers[markerId];
                }
            }

            function initMainMap() {
                mainMap = L.map(mainMapContainer, { maxBounds: tanauanBounds, minZoom: 12 }).setView(tanauanCenter, 13);
                L.tileLayer(tileUrl, { attribution: tileAttribution }).addTo(mainMap);
                
                L.rectangle(tanauanBounds, { color: "#fb923c", weight: 2, fillOpacity: 0.05 }).addTo(mainMap);

                L.circle(tanauanInstituteCoords, {
                    color: '#6366f1',
                    fillColor: '#818cf8', 
                    fillOpacity: 0.3,
                    radius: 200
                }).addTo(mainMap).bindPopup("<b>Tanauan Institute</b><br>Highlighted Area");
                
                // Clear all markers
                Object.keys(fireMarkers).forEach(removeMarker);
                
                // Add reports from localStorage
                localReports.forEach(report => {
                    const icon = report.type === 'user' ? userFireIcon : systemFireIcon;
                    const title = report.type === 'user' ? "User Report" : "System Detection";
                    addMarkerWithPopup(mainMap, [report.lat, report.lng], icon, title, report.id);
                });
                
                // Hide loading overlay once map is set up
                loadingOverlay.classList.add('opacity-0', 'pointer-events-none');
            }
            
            function initReportMap() {
                reportMap = L.map(reportMapContainer, { maxBounds: tanauanBounds, minZoom: 12 }).setView(tanauanCenter, 13);
                L.tileLayer(tileUrl, { attribution: tileAttribution }).addTo(reportMap);
                
                L.rectangle(tanauanBounds, { color: "#fb923c", weight: 2, fillOpacity: 0.05 }).addTo(reportMap);

                 L.circle(tanauanInstituteCoords, {
                     color: '#6366f1',
                     fillColor: '#818cf8',
                     fillOpacity: 0.3,
                     radius: 200
                 }).addTo(reportMap).bindPopup("<b>Tanauan Institute</b>");

                reportMap.on('click', function(e) { handleReportAction(e.latlng); });
            }

            function handleReportAction(latlng) {
                tempReportLocation = latlng;
                if (reportMapMarker) reportMapMarker.setLatLng(latlng);
                else reportMapMarker = L.marker(latlng).addTo(reportMap);
                alarmModal.classList.remove('hidden');
                confirmationView.classList.remove('hidden');
                alarmView.classList.add('hidden');
                errorView.classList.add('hidden');
            }
            
            async function getSuggestions() {
                const query = locationSearchInput.value;
                if (query.length < 3) { suggestionsBox.innerHTML = ''; suggestionsBox.classList.add('hidden'); return; }
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&countrycodes=ph&viewbox=${nominatimViewbox}&bounded=1&limit=5&addressdetails=1`);
                    const data = await response.json();
                    suggestionsBox.innerHTML = '';
                    if (data && data.length > 0) {
                        data.forEach(item => {
                            const div = document.createElement('div');
                            div.textContent = item.display_name;
                            div.className = 'suggestion-item';
                            div.dataset.lat = item.lat;
                            div.dataset.lon = item.lon;
                            div.addEventListener('click', () => {
                                locationSearchInput.value = item.display_name;
                                selectedSuggestionLocation = L.latLng(item.lat, item.lon);
                                reportMap.setView(selectedSuggestionLocation, 17);
                                suggestionsBox.innerHTML = '';
                                suggestionsBox.classList.add('hidden');
                            });
                            suggestionsBox.appendChild(div);
                        });
                        suggestionsBox.classList.remove('hidden');
                    } else { suggestionsBox.classList.add('hidden'); }
                } catch (error) { console.error('Suggestion fetch error:', error); }
            }

            async function reportFromSearch() {
                if (selectedSuggestionLocation) {
                    handleReportAction(selectedSuggestionLocation);
                    selectedSuggestionLocation = null;
                    return;
                }
                const query = locationSearchInput.value;
                if (!query) return;
                reportBtnText.textContent = "Reporting...";
                reportLocationBtn.disabled = true;
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&countrycodes=ph&viewbox=${nominatimViewbox}&bounded=1&limit=1`);
                    const data = await response.json();
                    if (data && data.length > 0) {
                        const loc = L.latLng(data[0].lat, data[0].lon);
                        reportMap.setView(loc, 17);
                        handleReportAction(loc);
                    } else {
                        console.warn("Location not found in Tanauan City. Please try a more specific query or click on the map.");
                        // Show error in modal
                        errorMessageText.textContent = "Location not found. Please try a more specific search or click on the map.";
                        alarmModal.classList.remove('hidden');
                        confirmationView.classList.add('hidden');
                        errorView.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error("Could not perform search. Please check your connection.");
                    errorMessageText.textContent = "Search failed. Please check your connection and try again.";
                    alarmModal.classList.remove('hidden');
                    confirmationView.classList.add('hidden');
                    errorView.classList.remove('hidden');
                }
                finally { reportBtnText.textContent = "Report"; reportLocationBtn.disabled = false; }
            }

            locationSearchInput.addEventListener('input', () => {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(getSuggestions, 300);
            });
            reportLocationBtn.addEventListener('click', reportFromSearch);
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.relative')) { suggestionsBox.classList.add('hidden'); }
            });

            cancelReportBtn.addEventListener('click', () => {
                alarmModal.classList.add('hidden'); tempReportLocation = null; if (reportMapMarker) { reportMap.removeLayer(reportMapMarker); reportMapMarker = null; }
            });

            confirmReportBtn.addEventListener('click', async () => {
                if (tempReportLocation) {
                    try {
                        const reportId = `user-${Date.now()}`;
                        // Create new report object to save locally
                        const newReport = {
                            id: reportId,
                            lat: tempReportLocation.lat,
                            lng: tempReportLocation.lng,
                            type: 'user',
                            timestamp: Date.now(),
                            reportedBy: userId // 'hardcoded_user'
                        };

                        // Add to local array
                        localReports.push(newReport);
                        // Save to localStorage
                        localStorage.setItem('ignisense_reports', JSON.stringify(localReports));
                        
                        // Add marker to the main map
                        addMarkerWithPopup(mainMap, [newReport.lat, newReport.lng], userFireIcon, "User Report", reportId);
                        
                        console.log("Report submitted locally with ID:", reportId);
                        
                        confirmationView.classList.add('hidden'); 
                        alarmView.classList.remove('hidden'); 
                        playAlarm();

                        if (reportMapMarker) { 
                            reportMap.removeLayer(reportMapMarker); 
                            reportMapMarker = null; 
                        }
                    } catch (error) {
                        console.error("Error adding local report: ", error);
                        errorMessageText.textContent = "Failed to submit report. Please try again.";
                        confirmationView.classList.add('hidden');
                        errorView.classList.remove('hidden');
                    }
                }
            });

            silenceAlarmBtn.addEventListener('click', () => {
                stopAlarm(); 
                alarmModal.classList.add('hidden'); 
                const lastReported = tempReportLocation; 
                showMainPage(); 
                if (lastReported) { mainMap.setView(lastReported, 16); } 
                tempReportLocation = null;
                 // Reset modal for next time
                setTimeout(() => {
                    confirmationView.classList.remove('hidden');
                    alarmView.classList.add('hidden');
                    errorView.classList.add('hidden');
                }, 300);
            });

            closeErrorBtn.addEventListener('click', () => {
                alarmModal.classList.add('hidden');
                tempReportLocation = null; 
                if (reportMapMarker) { 
                    reportMap.removeLayer(reportMapMarker); 
                    reportMapMarker = null; 
                }
                setTimeout(() => {
                    confirmationView.classList.remove('hidden');
                    alarmView.classList.add('hidden');
                    errorView.classList.add('hidden');
                }, 300);
            });

            // This listener updates the map if localStorage is changed in *another* tab (e.g., admin)
            window.addEventListener('storage', (event) => {
                if (event.key === 'ignisense_reports') {
                    console.log("Report data updated from another page. Reloading map.");
                    localReports = JSON.parse(event.newValue || '[]');
                    // Re-initialize the main map to show changes
                    initMainMap();
                }
            });

            // Initialize the map and listeners
            initMainMap();
        }
        
        // Start the auth check
        document.addEventListener('DOMContentLoaded', initializeAuthListener);

    </script>
</body>
</html>

